<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Sinai - Emiss√£o de Certificados</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Great+Vibes&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0a1f44; /* Azul Marinho Profundo */
            --gold: #c5a059;    /* Dourado Ma√ß√¥nico */
            --gold-light: #e5c585;
            --bg: #f4f4f4;
            --white: #ffffff;
            --danger: #8b0000;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background: var(--bg);
            color: #333;
            min-height: 100vh;
        }

        /* --- LOGIN --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, #000 100%);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
        }
        
        .login-box {
            background: var(--white); padding: 40px; border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); width: 350px; text-align: center;
            border-top: 5px solid var(--gold);
        }

        .login-box h2 { color: var(--primary); margin-bottom: 20px; font-family: 'Cinzel', serif; }
        .login-box input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        .btn-gold { 
            background: var(--gold); color: var(--primary); font-weight: bold; border: none; 
            padding: 10px 20px; border-radius: 4px; cursor: pointer; width: 100%; margin-top: 10px;
            transition: 0.3s;
        }
        .btn-gold:hover { background: var(--gold-light); }

        /* --- LAYOUT PRINCIPAL --- */
        #app { display: none; }
        
        nav {
            background: var(--primary); color: var(--gold); padding: 15px 40px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        nav h1 { font-family: 'Cinzel', serif; font-size: 1.5rem; }
        
        .nav-links button {
            background: transparent; border: 1px solid var(--gold); color: var(--gold);
            padding: 8px 15px; margin-left: 10px; cursor: pointer; border-radius: 4px;
        }
        .nav-links button:hover { background: var(--gold); color: var(--primary); }
        .nav-links button.logout { border-color: var(--danger); color: #ff6b6b; }
        .nav-links button.logout:hover { background: var(--danger); color: white; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; display: grid; grid-template-columns: 350px 1fr; gap: 30px; }

        /* --- CONTROLES ESQUERDA --- */
        .controls { background: var(--white); padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .controls h3 { color: var(--primary); border-bottom: 2px solid var(--gold); padding-bottom: 10px; margin-bottom: 20px; font-family: 'Cinzel', serif; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.9rem; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .form-group select, .form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        
        .add-btn { font-size: 0.8rem; color: var(--primary); text-decoration: underline; cursor: pointer; display: block; margin-top: 2px; text-align: right;}

        .letter-filter { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; }
        .letter-filter button { 
            font-size: 0.7rem; padding: 2px 5px; background: #eee; border: none; cursor: pointer; 
        }
        .letter-filter button:hover { background: var(--gold); }

        /* --- CERTIFICADO (Visualiza√ß√£o) --- */
        .certificate-wrapper { 
            background: #555; padding: 40px; border-radius: 8px; 
            display: flex; justify-content: center; align-items: center; 
        }

        #certificate {
            width: 1123px; height: 794px; /* Tamanho A4 Paisagem (aprox em pixels para tela) */
            background: var(--white);
            position: relative;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transform: scale(0.65); /* Escala para caber na tela */
            transform-origin: top center;
            color: #000;
            border: 20px solid var(--primary);
        }

        /* DESIGN DO CERTIFICADO */
        .cert-inner-border {
            border: 5px solid var(--gold);
            height: 100%;
            padding: 40px;
            position: relative;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }

        .cert-corner {
            position: absolute; width: 60px; height: 60px;
            border-top: 5px solid var(--gold); border-left: 5px solid var(--gold);
        }
        .tr { top: 10px; right: 10px; transform: rotate(90deg); }
        .br { bottom: 10px; right: 10px; transform: rotate(180deg); }
        .bl { bottom: 10px; left: 10px; transform: rotate(270deg); }
        .tl { top: 10px; left: 10px; }

        .cert-header h1 {
            font-family: 'Cinzel', serif; font-size: 3rem; color: var(--primary);
            margin-bottom: 10px; letter-spacing: 2px;
        }
        .cert-header h2 {
            font-family: 'Cinzel', serif; font-size: 1.5rem; color: var(--gold);
            text-transform: uppercase; margin-bottom: 40px;
        }

        .cert-body { font-size: 1.4rem; line-height: 2; width: 90%; margin: 0 auto; font-family: 'Playfair Display', serif; }
        .cert-body span { 
            font-weight: bold; color: var(--primary); border-bottom: 1px solid #999; padding: 0 10px; display: inline-block; min-width: 100px;
        }

        .cert-signatures {
            margin-top: auto; width: 100%; display: flex; justify-content: space-around; padding-bottom: 20px;
        }
        .signature-line { width: 300px; border-top: 1px solid #000; text-align: center; padding-top: 10px; }
        .signature-line p { font-size: 0.9rem; text-transform: uppercase; color: var(--primary); font-weight: bold; }
        .signature-font { font-family: 'Great Vibes', cursive; font-size: 2.5rem; color: #000; margin-bottom: -10px; display: block; height: 50px;}

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; width: 400px; }
        
        /* --- PRINT --- */
        @media print {
            body * { visibility: hidden; }
            #certificate, #certificate * { visibility: visible; }
            #certificate {
                position: fixed; left: 0; top: 0; width: 100%; height: 100%;
                margin: 0; padding: 0; transform: none; box-shadow: none; border: 20px solid var(--primary);
            }
            .certificate-wrapper { padding: 0; background: none; }
            @page { size: landscape; margin: 0; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <div style="font-size: 3rem; color: var(--gold); margin-bottom: 10px;">G‚à¥A‚à¥D‚à¥U‚à¥</div>
            <h2>Acesso Restrito</h2>
            <form onsubmit="app.login(event)">
                <input type="text" id="user" placeholder="Usu√°rio" required>
                <input type="password" id="pass" placeholder="Senha" required>
                <button type="submit" class="btn-gold">ENTRAR</button>
            </form>
            <p style="margin-top:15px; font-size:0.8rem; color:#666;">Admin: admin/admin | User: user/user</p>
        </div>
    </div>

    <div id="app">
        <nav>
            <h1>üèõÔ∏è Monte Sinai</h1>
            <div class="nav-links">
                <button onclick="window.print()">üñ®Ô∏è Imprimir / PDF</button>
                <button onclick="app.resetForm()">üßπ Limpar</button>
                <button class="logout" onclick="app.logout()">Sair</button>
            </div>
        </nav>

        <div class="container">
            <div class="controls">
                <h3>Dados do Certificado</h3>

                <div class="form-group">
                    <label>Filtrar Irm√£o por Inicial:</label>
                    <div class="letter-filter" id="letter-filters">
                        </div>
                </div>

                <div class="form-group">
                    <label>Nome do Irm√£o:</label>
                    <select id="inputIrmao" onchange="app.updateCert()"></select>
                    <small class="add-btn" onclick="app.openModal('irmaos')">+ Adicionar Novo</small>
                </div>

                <div class="form-group">
                    <label>Grau:</label>
                    <select id="inputGrau" onchange="app.updateCert()"></select>
                    <small class="add-btn" onclick="app.openModal('graus')">+ Adicionar Novo</small>
                </div>

                <div class="form-group">
                    <label>Sess√£o:</label>
                    <select id="inputSessao" onchange="app.updateCert()"></select>
                    <small class="add-btn" onclick="app.openModal('sessoes')">+ Adicionar Nova</small>
                </div>

                <div class="form-group">
                    <label>Pot√™ncia:</label>
                    <select id="inputPotencia" onchange="app.updateCert()"></select>
                    <small class="add-btn" onclick="app.openModal('potencias')">+ Adicionar Nova</small>
                </div>

                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="inputData" onchange="app.updateCert()">
                </div>

                <div class="form-group">
                    <label>Obreiro (Assina como Secret√°rio):</label>
                    <select id="inputObreiro" onchange="app.updateCert()"></select>
                    <small class="add-btn" onclick="app.openModal('obreiros')">+ Adicionar Novo</small>
                </div>
            </div>

            <div class="certificate-wrapper">
                <div id="certificate">
                    <div class="cert-inner-border">
                        <div class="cert-corner tl"></div>
                        <div class="cert-corner tr"></div>
                        <div class="cert-corner bl"></div>
                        <div class="cert-corner br"></div>

                        <div class="cert-header">
                            <div style="font-size: 4rem; color: var(--gold); margin-bottom: 10px;">G‚à¥</div>
                            <h1>Loja Ma√ß√¥nica Monte Sinai</h1>
                            <h2>Certificado de Presen√ßa</h2>
                        </div>

                        <div class="cert-body">
                            <p>
                                Certificamos que o Irm√£o <span id="viewIrmao">Nome do Irm√£o</span>, 
                                detentor do Grau <span id="viewGrau">Grau</span>, 
                                esteve presente na <span id="viewSessao">Tipo da Sess√£o</span>, 
                                realizada sob os ausp√≠cios da Pot√™ncia <span id="viewPotencia">Pot√™ncia</span>.
                            </p>
                            <p style="margin-top: 20px;">
                                Porto Alegre, <span id="viewData">__/__/____</span>.
                            </p>
                        </div>

                        <div class="cert-signatures">
                            <div class="signature-line">
                                <span class="signature-font">Vener√°vel Mestre</span>
                                <p>Vener√°vel Mestre</p>
                            </div>
                            <div class="signature-line">
                                <span class="signature-font" id="viewObreiroSign">Secret√°rio</span>
                                <p>Secret√°rio / Obreiro</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Adicionar</h3>
            <input type="text" id="modalInput" style="width: 100%; padding: 10px; margin: 15px 0;" placeholder="Digite o nome...">
            <div style="text-align: right;">
                <button onclick="document.getElementById('modal').style.display='none'" style="padding: 8px 15px;">Cancelar</button>
                <button onclick="app.saveData()" class="btn-gold" style="width: auto;">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        const app = {
            data: {
                irmaos: [],
                graus: ['Aprendiz', 'Companheiro', 'Mestre', 'Mestre Instalado'],
                sessoes: ['Sess√£o Magna de Inicia√ß√£o', 'Sess√£o Ordin√°ria', 'Sess√£o Branca', 'Banquete Ritual√≠stico'],
                potencias: ['GOB - Grande Oriente do Brasil', 'GLMERGS', 'GORGS'],
                obreiros: ['Secret√°rio da Loja', 'Irm√£o Secret√°rio Ad Hoc']
            },
            currentModalContext: '',

            init: function() {
                // Carregar dados do LocalStorage ou usar padr√£o
                const savedData = localStorage.getItem('monteSinaiDB');
                if (savedData) {
                    this.data = JSON.parse(savedData);
                }
                
                // Verificar Login
                if (sessionStorage.getItem('logged') === 'true') {
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('app').style.display = 'block';
                    this.renderFilters();
                    this.populateSelects();
                    // Set data de hoje
                    document.getElementById('inputData').valueAsDate = new Date();
                    this.updateCert();
                }

                // Renderizar letras A-Z
                this.renderFilters();
            },

            login: function(e) {
                e.preventDefault();
                const user = document.getElementById('user').value;
                const pass = document.getElementById('pass').value;

                if ((user === 'admin' && pass === 'admin') || (user === 'user' && pass === 'user')) {
                    sessionStorage.setItem('logged', 'true');
                    sessionStorage.setItem('role', user === 'admin' ? 'admin' : 'user');
                    location.reload();
                } else {
                    alert('Credenciais inv√°lidas!');
                }
            },

            logout: function() {
                sessionStorage.clear();
                location.reload();
            },

            saveToStorage: function() {
                localStorage.setItem('monteSinaiDB', JSON.stringify(this.data));
            },

            populateSelects: function(filterLetter = null) {
                this.fillSelect('inputGrau', this.data.graus);
                this.fillSelect('inputSessao', this.data.sessoes);
                this.fillSelect('inputPotencia', this.data.potencias);
                this.fillSelect('inputObreiro', this.data.obreiros);

                // Irm√£os com filtro
                const irmaosList = filterLetter 
                    ? this.data.irmaos.filter(i => i.toUpperCase().startsWith(filterLetter))
                    : this.data.irmaos;
                
                this.fillSelect('inputIrmao', irmaosList.sort());
            },

            fillSelect: function(id, array) {
                const select = document.getElementById(id);
                const currentVal = select.value;
                select.innerHTML = '<option value="">Selecione...</option>';
                array.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item;
                    opt.textContent = item;
                    select.appendChild(opt);
                });
                select.value = currentVal; // Tenta manter sele√ß√£o
            },

            renderFilters: function() {
                const container = document.getElementById('letter-filters');
                container.innerHTML = '<button onclick="app.populateSelects()">Todos</button>';
                const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
                alphabet.forEach(letter => {
                    container.innerHTML += `<button onclick="app.populateSelects('${letter}')">${letter}</button>`;
                });
            },

            openModal: function(context) {
                // Verifica permiss√£o (apenas visual, l√≥gica simples)
                if (sessionStorage.getItem('role') !== 'admin') {
                    alert('Apenas administradores podem adicionar novos registros.');
                    return;
                }
                this.currentModalContext = context;
                document.getElementById('modalTitle').textContent = 'Adicionar em ' + context.charAt(0).toUpperCase() + context.slice(1);
                document.getElementById('modalInput').value = '';
                document.getElementById('modal').style.display = 'flex';
                document.getElementById('modalInput').focus();
            },

            saveData: function() {
                const val = document.getElementById('modalInput').value.trim();
                if (val) {
                    if (!this.data[this.currentModalContext].includes(val)) {
                        this.data[this.currentModalContext].push(val);
                        this.saveToStorage();
                        this.populateSelects();
                        document.getElementById('modal').style.display = 'none';
                        alert('Registro salvo com sucesso!');
                    } else {
                        alert('Este registro j√° existe.');
                    }
                }
            },

            updateCert: function() {
                const fields = ['Irmao', 'Grau', 'Sessao', 'Potencia', 'Obreiro'];
                
                fields.forEach(field => {
                    const val = document.getElementById('input' + field).value;
                    const el = document.getElementById('view' + field);
                    if (el) el.textContent = val || '__________________';
                    
                    // Assinatura especial para o Obreiro
                    if (field === 'Obreiro') {
                        document.getElementById('viewObreiroSign').textContent = val || 'Secret√°rio';
                    }
                });

                const dataVal = document.getElementById('inputData').value;
                if (dataVal) {
                    const [ano, mes, dia] = dataVal.split('-');
                    document.getElementById('viewData').textContent = `${dia}/${mes}/${ano}`;
                } else {
                    document.getElementById('viewData').textContent = '__/__/____';
                }
            },

            resetForm: function() {
                document.querySelectorAll('select').forEach(s => s.value = '');
                this.updateCert();
            }
        };

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>